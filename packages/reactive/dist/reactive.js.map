{
  "version": 3,
  "sources": ["../../shared/src/index.ts", "../src/effect.ts", "../src/handles.ts", "../src/reactive.ts"],
  "sourcesContent": ["export const isObject = val => val !== null && typeof val === 'object'\nexport const isFunction = val => typeof val === 'function'", "export let ActiveEffect = null\n\n// \u7528\u4E8E\u5B58\u50A8\u539F\u59CB\u5BF9\u8C61\u548C\u4EE3\u7406\u5BF9\u8C61\u7684\u6620\u5C04\u5173\u7CFB\nexport const effect = (fn, options = {}) => {\n  // ...\n  const effect = new CreateReactiveEffect(fn, options)\n  // ...\n  return effect\n}\n\nclass CreateReactiveEffect {\n  private parent\n  constructor(public fn,public options) {\n    this.run()\n  }\n  run() {\n    // debugger\n    try {\n      // effect\u4F1A\u53D1\u751F\u5D4C\u5957\uFF0C\u6309\u7167\u6811\u7ED3\u6784\u4FDD\u5B58\u7236\u7EA7\n      this.parent = ActiveEffect\n      ActiveEffect = this\n      this.fn()\n    } finally {\n      ActiveEffect = this.parent\n      this.parent = null\n    }\n  }\n}\n// targetMap \u7ED3\u6784\u5982\u4E0B\n// {\n//   target1: {\n//     key1: [effect1, effect2],\n//     key2: [effect3, effect4]\n//   },\n//   target2: {\n//     key1: [effect5, effect6],\n//     key2: [effect7, effect8]\n//   }\n// }\nconst targetMap = new WeakMap();\n// \u7528\u4E8E\u6536\u96C6\u4F9D\u8D56\nexport const track = (target, key, value) => {\n  // ...\n  if (!ActiveEffect) return\n  let depsMap = targetMap.get(target)\n  if (!depsMap) {\n    targetMap.set(target, (depsMap = new Map()))\n  }\n  let dep = depsMap.get(key)\n  if (!dep) {\n    depsMap.set(key, (dep = new Set()))\n  }\n  if (!dep.has(ActiveEffect)) {\n    dep.add(ActiveEffect)\n  }\n}\n\n// \u7528\u4E8E\u89E6\u53D1\u66F4\u65B0\nexport const trigger = (target, key, newVal, oldVal) => {\n  // ...\n  let depsMap = targetMap.get(target)\n  if (!depsMap) return\n  let dep = depsMap.get(key)\n  dep && dep.forEach(effect => {\n    if (effect !== ActiveEffect) {\n      effect.run()\n    }\n  })\n}", "import { track, trigger } from \"./effect\";\nimport { ReactiveFlags } from \"./reactive\";\n\n// \nexport const baseHandlers = {\n  get(target, key, receiver) {\n    // \u7ED9\u4EE3\u7406\u5BF9\u8C61\u6DFB\u52A0\u6807\u8BC6\uFF0C\u9632\u6B62\u91CD\u590D\u4EE3\u7406\n    if (key === ReactiveFlags.IS_REACTIVE) {\n      return true\n    }\n    const res = Reflect.get(target, key, receiver)\n    // ...\n    track(target, key, res)\n    return res\n  },\n  set(target, key, value, receiver) {\n    // ...\n    const oldVal = Reflect.get(target, key, receiver)\n    const res = Reflect.set(target, key, value, receiver)\n    trigger(target, key, value, oldVal)\n    return res\n  }\n};", "import { isObject } from '@vue/shared'\nimport { baseHandlers } from './handles'\n\n// \u7528\u4E8E\u5B58\u50A8\u539F\u59CB\u5BF9\u8C61\u548C\u4EE3\u7406\u5BF9\u8C61\u7684\u6620\u5C04\u5173\u7CFB\nconst toProxyWeakMap = new WeakMap()\n\nexport const enum ReactiveFlags {\n  IS_REACTIVE = '__v_isReactive',\n}\n\nexport const reactive = (target: object) => {\n  if (!isObject(target)) {\n    // \u975E\u5BF9\u8C61\u7C7B\u578B\u65E0\u6CD5\u88AB\u4EE3\u7406\n    throw new Error(`target must be an object`)\n  }\n  // target \u5DF2\u7ECF\u662F\u4E00\u4E2A Proxy \u4E86\uFF0C\u76F4\u63A5\u8FD4\u56DE\n  const existingProxy = toProxyWeakMap.get(target)\n  if (existingProxy) return existingProxy\n\n  // target \u5DF2\u7ECF\u662F\u4E00\u4E2A\u54CD\u5E94\u5F0F\u5BF9\u8C61\u4E86\uFF0C\u76F4\u63A5\u8FD4\u56DE\n  if (target[ReactiveFlags.IS_REACTIVE]) return target\n\n  // \u9632\u6B62\u4EE3\u7406\u8FC7\u7684\u5BF9\u8C61\u88AB\u91CD\u590D\u4EE3\u7406\n  const proxy = new Proxy(target, baseHandlers)\n  // \u5C06\u539F\u59CB\u5BF9\u8C61\u548C\u4EE3\u7406\u5BF9\u8C61\u5B58\u50A8\u8D77\u6765\n  toProxyWeakMap.set(target, proxy)\n  return proxy\n  // ...\n}\nconst o = { count: 0 }\nconst state = reactive(o)\nconst state1 = reactive(o)\nconst state2 = reactive(state1)\nconsole.log(state === state1) // true);\nconsole.log(state1 === state2) // true);\n\n"],
  "mappings": ";AAAO,IAAM,WAAW,SAAO,QAAQ,QAAQ,OAAO,QAAQ;;;ACAvD,IAAI,eAAe;AAGnB,IAAM,SAAS,CAAC,IAAI,UAAU,CAAC,MAAM;AAE1C,QAAMA,UAAS,IAAI,qBAAqB,IAAI,OAAO;AAEnD,SAAOA;AACT;AAEA,IAAM,uBAAN,MAA2B;AAAA,EAEzB,YAAmB,IAAU,SAAS;AAAnB;AAAU;AAC3B,SAAK,IAAI;AAAA,EACX;AAAA,EACA,MAAM;AAEJ,QAAI;AAEF,WAAK,SAAS;AACd,qBAAe;AACf,WAAK,GAAG;AAAA,IACV,UAAE;AACA,qBAAe,KAAK;AACpB,WAAK,SAAS;AAAA,IAChB;AAAA,EACF;AACF;AAYA,IAAM,YAAY,oBAAI,QAAQ;AAEvB,IAAM,QAAQ,CAAC,QAAQ,KAAK,UAAU;AAE3C,MAAI,CAAC;AAAc;AACnB,MAAI,UAAU,UAAU,IAAI,MAAM;AAClC,MAAI,CAAC,SAAS;AACZ,cAAU,IAAI,QAAS,UAAU,oBAAI,IAAI,CAAE;AAAA,EAC7C;AACA,MAAI,MAAM,QAAQ,IAAI,GAAG;AACzB,MAAI,CAAC,KAAK;AACR,YAAQ,IAAI,KAAM,MAAM,oBAAI,IAAI,CAAE;AAAA,EACpC;AACA,MAAI,CAAC,IAAI,IAAI,YAAY,GAAG;AAC1B,QAAI,IAAI,YAAY;AAAA,EACtB;AACF;AAGO,IAAM,UAAU,CAAC,QAAQ,KAAK,QAAQ,WAAW;AAEtD,MAAI,UAAU,UAAU,IAAI,MAAM;AAClC,MAAI,CAAC;AAAS;AACd,MAAI,MAAM,QAAQ,IAAI,GAAG;AACzB,SAAO,IAAI,QAAQ,CAAAA,YAAU;AAC3B,QAAIA,YAAW,cAAc;AAC3B,MAAAA,QAAO,IAAI;AAAA,IACb;AAAA,EACF,CAAC;AACH;;;AChEO,IAAM,eAAe;AAAA,EAC1B,IAAI,QAAQ,KAAK,UAAU;AAEzB,QAAI,4CAAmC;AACrC,aAAO;AAAA,IACT;AACA,UAAM,MAAM,QAAQ,IAAI,QAAQ,KAAK,QAAQ;AAE7C,UAAM,QAAQ,KAAK,GAAG;AACtB,WAAO;AAAA,EACT;AAAA,EACA,IAAI,QAAQ,KAAK,OAAO,UAAU;AAEhC,UAAM,SAAS,QAAQ,IAAI,QAAQ,KAAK,QAAQ;AAChD,UAAM,MAAM,QAAQ,IAAI,QAAQ,KAAK,OAAO,QAAQ;AACpD,YAAQ,QAAQ,KAAK,OAAO,MAAM;AAClC,WAAO;AAAA,EACT;AACF;;;AClBA,IAAM,iBAAiB,oBAAI,QAAQ;AAE5B,IAAW,gBAAX,kBAAWC,mBAAX;AACL,EAAAA,eAAA,iBAAc;AADE,SAAAA;AAAA,GAAA;AAIX,IAAM,WAAW,CAAC,WAAmB;AAC1C,MAAI,CAAC,SAAS,MAAM,GAAG;AAErB,UAAM,IAAI,MAAM,0BAA0B;AAAA,EAC5C;AAEA,QAAM,gBAAgB,eAAe,IAAI,MAAM;AAC/C,MAAI;AAAe,WAAO;AAG1B,MAAI,OAAO,kCAAyB;AAAG,WAAO;AAG9C,QAAM,QAAQ,IAAI,MAAM,QAAQ,YAAY;AAE5C,iBAAe,IAAI,QAAQ,KAAK;AAChC,SAAO;AAET;AACA,IAAM,IAAI,EAAE,OAAO,EAAE;AACrB,IAAM,QAAQ,SAAS,CAAC;AACxB,IAAM,SAAS,SAAS,CAAC;AACzB,IAAM,SAAS,SAAS,MAAM;AAC9B,QAAQ,IAAI,UAAU,MAAM;AAC5B,QAAQ,IAAI,WAAW,MAAM;",
  "names": ["effect", "ReactiveFlags"]
}
